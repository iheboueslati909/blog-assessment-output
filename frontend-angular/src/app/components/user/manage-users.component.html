<div class="p-6 space-y-6">

  <!-- Users Management Card -->
  <div class="bg-gray-800 p-6 rounded-lg shadow-md space-y-4">
    <h1 class="page-title text-2xl font-bold text-white mb-4">Manage Users</h1>

    <!-- Loading & Error -->
    <div *ngIf="loading" class="text-gray-400">Loading...</div>
    <div *ngIf="error" class="text-red-500 font-medium">{{ error }}</div>

    <!-- Users Table -->
    <ng-container *ngIf="!loading && !error">
      <div *ngIf="users.length > 0; else noUsers" class="overflow-x-auto">
        <table class="w-full table-auto border-collapse">
          <thead>
            <tr class="text-left text-sm text-gray-300 border-b border-gray-700">
              <th class="p-2">Name</th>
              <th class="p-2">Email</th>
              <th class="p-2">Role</th>
              <th class="p-2 text-right">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let u of users" class="border-b border-gray-700 hover:bg-gray-700 transition">
              <td class="p-2 text-gray-200">{{ u.name }}</td>
              <td class="p-2 text-gray-200">{{ u.email }}</td>
              <td class="p-2">
                <select
                  class="bg-gray-700 text-gray-200 rounded px-2 py-1 text-sm"
                  [ngModel]="u.pendingRole"
                  (ngModelChange)="setPendingRole(u, $event)"
                  [disabled]="isSelf(u) && u.roles?.[0] === 'Admin'"
                >
                  <option *ngFor="let r of rolesOptions" [value]="r">{{ r }}</option>
                </select>
              </td>
              <td class="p-2 text-right">
                <button
                  (click)="commitRole(u)"
                  class="px-3 py-1 bg-green-600 hover:bg-green-500 rounded text-sm text-white shadow"
                  [disabled]="u.pendingRole === u.roles?.[0]"
                >
                  Save
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <ng-template #noUsers>
        <p class="text-gray-400">No users found.</p>
      </ng-template>

      <!-- Pagination -->
      <div class="mt-4 flex items-center justify-between">
        <div class="text-sm text-gray-400">
          Page {{ page }} / {{ totalPages }} â€” {{ total }} users
        </div>
        <div class="space-x-2">
          <button (click)="prev()" 
                  class="px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded shadow" 
                  [disabled]="page <= 1">Prev</button>
          <button (click)="next()" 
                  class="px-3 py-1 bg-gray-700 hover:bg-gray-600 text-white rounded shadow" 
                  [disabled]="page >= totalPages">Next</button>
        </div>
      </div>
    </ng-container>
  </div>
</div>
